#!/bin/sh
begin='FS="="; RS="&";'
end='printf "d10:magnet-uri%d:%se\n", length(url), url'

while getopts ":d" opt; do case $opt in 
	d) dn='true'; end='printf "%s\n", dn';;
	*) echo "${0##*/}: unrecongnized option '$opt'" 1>&2
esac; done


while read -r line; do
	echo "$line" | tr -d '\n' |
		awk "BEGIN { $begin } \$1 == \"dn\" { dn=\$2 } { url = url \$0 }
		END { $end }" | if [ -n "$dn" ]; then
			sed 's/%/\\\\x/g' | xargs printf '%b\n'
		else
			cat
		fi
done
