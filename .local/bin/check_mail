#!/usr/bin/sh
environs=`pidof dbus-daemon | tr ' ' '\n'  | head -n 1 | awk '{printf "/proc/%s/environ ", $1}'`
export DBUS_SESSION_BUS_ADDRESS=`cat $environs 2>/dev/null | tr '\0' '\n' | grep DBUS_SESSION_BUS_ADDRESS | cut -d '=' -f2-`
export DISPLAY=:0
export XDG_RUNTIME_DIR="/run/user/1000"

count=$(timeout 6 ssh -i /home/jer/.ssh/id_rsa jer@jer.cx 'ls ~/.mail/new' | wc -l)

if [ "$?" -ne 0 ]; then
	echo 'SSH failed or surpassed timeout' >&2 
	exit 1
fi

if [ "$count" -gt 0 ]; then
	play "$HOME/Media/Audio/Recordings/bow.mp3" vol 0.25 & 
	notify-send 'Mail' "You've got $count new mail."
fi
