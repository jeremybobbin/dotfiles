#!/bin/sh

if [ "$#" -eq 0 ]; then
	die "provide arguments"
fi

die() {
	echo "$0: $*" 1>&2
	exit 1
}

if [ $EDITOR = 'vim' ]; then
	REMOTE="vim --servername $VIM_SERVERNAME "
elif [ $EDITOR = 'nvim' ] && [ -x "$(command -v rnvr)" ]; then
	REMOTE="rnvr"
elif [ -x "$(command -v nvr)" ]; then
	REMOTE="nvr --servername $NVIM_LISTEN_ADDRESS"
else
	die "I don't know how to handle this."
fi

remote() {
	$REMOTE "$@";
}

# send ex command
excmd() {
	$REMOTE --remote-expr "execute('$*')";
}

if getopts ":e" opt; then 
	shift $((OPTIND - 1))
	case "${opt}" in
		e) excmd "$*"
			;;
		\?) die "invalid option - '$OPTARG'"
			;;
		:) die "invalid option. '$OPTARG' requires an argument"
			;;
	esac
else
	remote --remote-send "$*"
fi
