#!/bin/sh

send() {
	if [ $EDITOR = 'vim' ]; then
		$EDITOR --servername $VIM_SERVERNAME --remote-send "$*"
	elif [ $EDITOR = 'nvim' ]; then
		 nvr --servername $VIM_SERVERNAME --remote-send "$*"
	fi
}

# send ex command
excmd() {
	send "<C-W>:$*<Enter>"
}

die() {
	echo "$0: $*" 1>&2
	exit 1
}

if [ "$#" -eq 0 ]; then
	die "provide arguments"
fi

if getopts ":e" opt; then 
	shift $((OPTIND - 1))
	case "${opt}" in
		e) excmd "$*"
			;;
		\?) die "invalid option - '$OPTARG'"
			;;
		:) die "invalid option. '$OPTARG' requires an argument"
			;;
	esac
else
	send "$*"
fi
