#!/bin/sh
engines_dir=$XDG_BIN_HOME/web/engines
cache=$XDG_CACHE_HOME/search

[ ! -r $cache ] && touch $cache

engine=$({ 
	tac $cache;
	ls $engines_dir;
} | nl | sort -uk2 | sort -nk1 | cut -f2- | dmenu -p "Where to search: ")

[ ! $engine ] || [ ! "$?" ] && exit 1

query=$(echo | dmenu -p 'What to search:')

[ ! $query ] || [ ! "$?" ] && exit 1

("$engine" "$query" &)

echo $engine >> $cache
sed -e :a -e '$q;N;11,$D;ba' -i $cache
